<h1 class="page-header">Modification du projet {{project?.title}}</h1>
<div class="container">
    <div class="row tab-content">
        <div role="tabpanel" class="tab-pane active">
            <form class="form-horizontal" id="edit-project-form" [formGroup]="editProjectForm" (submit)="editProject($event)">
                <br>

                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['title'].valid}">
                    <label for="title" class="col-sm-2">Titre <span class="asterisque"> * </span></label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" name="title" id="title"
                          placeholder="Titre du projet" [formControl]="editProjectForm.controls['title']">
                    </div>
                </div>

                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['latitude'].valid}">
                    <label for="latitude" class="col-sm-2">Latitude <span class="asterisque"> * </span></label>
                    <div class="col-sm-10">
                        <input type="number" class="form-control bfh-number" name="latitude" id="latitude"
                          [formControl]="editProjectForm.controls['latitude']" step="0.000001">
                    </div>
                </div>

                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['longitude'].valid}">
                    <label for="longitude" class="col-sm-2">Longitude <span class="asterisque"> * </span></label>
                    <div class="col-sm-10">
                        <input type="number" class="form-control bfh-number" name="longitude" id="longitude"
                          [formControl]="editProjectForm.controls['longitude']" step="0.000001">
                    </div>
                </div>


                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['country'].valid}">
                    <label for="country" class="col-sm-2">Pays </label>
                    <div class="col-sm-10">
                        <select class="form-control" id="country" [formControl]="editProjectForm.controls['country']">
                            <option value="" selected>-- sélectionnez un pays --</option>
                            <option value='France'>France</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['department'].valid}">
                    <label for="department" class="col-sm-2">Département</label>
                    <div class="col-sm-10">
                        <select class="form-control" id="department" [formControl]="editProjectForm.controls['department']">
                            <option value="" selected>-- sélectionnez un département --</option>
                            <option *ngFor="let department of country.departments"
                                [value]="department.name">
                                {{department.zip_code}} - {{department.name}}
                            </option>
                        </select>
                    </div>
                </div>

                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['city'].valid}">
                    <label for="city" class="col-sm-2">Ville </label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="city" placeholder="Entrez votre ville de résidence"
                        [formControl]="editProjectForm.controls['city']">
                    </div>
                </div>

                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['postalCode'].valid}">
                    <label for="postalCode" class="col-sm-2">Code postal </label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="postalCode" 
                        placeholder="Entrez votre code postal" [formControl]="editProjectForm.controls['postalCode']">
                    </div>
                </div>

                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['streetNumber'].valid}">
                    <label for="streetNumber" class="col-sm-2">Numéro de rue</label>
                    <div class="col-sm-10">
                        <input type="number" min="0" class="form-control" id="streetNumber" 
                        placeholder="Entrez numéro de rue" [formControl]="editProjectForm.controls['streetNumber']">
                    </div>
                </div>

                <div class="form-group" [ngClass]="{'has-error':!editProjectForm.controls['streetName'].valid}">
                    <label for="streetName" class="col-sm-2">Rue </label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="streetName" placeholder="Entrez votre rue" 
                        [formControl]="editProjectForm.controls['streetName']">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2">Appels d'offre</label>
                    <div class="col-sm-10">
                        <table class="table zebra-striped">
                        <thead>
                        <tr>
                            <th>Description</th>
                            <th>Type</th>
                            <th>Date de lancement</th>
                            <th>Montant</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor='let tender of project.tenders; let i=index'>
                            <td>{{tender.description}}</td>
                            <td>{{tender.type}}</td>
                            <td>{{tender.launchDate}}</td>
                            <td>{{tender.amount}} €</td>
                            <td>
                                <a class="text-primary" (click)=selectTender(tender) data-toggle="modal" data-target="#editTenderForm">
                                    <span class="glyphicon glyphicon-edit"></span>
                                </a> 
                                <a class="text-danger" mwlConfirm [title]="title" [message]="'Êtes vous sur de vouloir supprimer cet appel d\'offre ?'" 
                                (confirm)="deleteTender(i)">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </a>
                            </td>
                            </tr>
                        </tbody>
                        </table>
                    </div>

                </div>
                <button type="submit" class="btn btn-primary" [disabled]="!editProjectForm.valid">Valider</button>
            </form>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="editTenderForm" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true" >
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
          <span aria-hidden="true">&times;</span>
          <span class="sr-only">Close</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">
            Modification d'un appel d'offre
        </h4>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <form role="form" [formGroup]="editTenderForm" (submit)="editTender($event)">
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['authority'].valid}">
            <label for="authority">Autorité</label>
            <input type="text" class="form-control" id="authority" [formControl]="editTenderForm.controls['authority']"/> 
          </div>
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['description'].valid}">
            <label for="description">Description</label>
            <textarea class="form-control" rows="5" id="description" [formControl]="editTenderForm.controls['description']"></textarea>
          </div>
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['type'].valid}">
            <label for="type">Type</label>
            <input type="text" class="form-control" id="type" [formControl]="editTenderForm.controls['type']"/>
          </div>
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['startDate'].valid}">
            <label for="startDate">Date de départ</label>
            <input type="date" class="form-control" id="startDate" [formControl]="editTenderForm.controls['startDate']"/>
          </div>
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['signDate'].valid}">
            <label for="signDate">Signature le</label>
            <input type="date" class="form-control" id="signDate" [formControl]="editTenderForm.controls['signDate']"/>
          </div>
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['attributionDate'].valid}">
            <label for="attributionDate">Date d'attribution</label>
            <input type="date" class="form-control" id="attributionDate" [formControl]="editTenderForm.controls['attributionDate']"/>
          </div>
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['launchDate'].valid}">
            <label for="launchDate">Date de lancement</label>
            <input type="date" class="form-control" id="launchDate" [formControl]="editTenderForm.controls['launchDate']"/>
          </div>
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['mode'].valid}">
            <label for="mode">Mode</label>
            <input type="text" class="form-control" id="mode" [formControl]="editTenderForm.controls['mode']"/>
          </div>
          <div class="form-group" [ngClass]="{'has-error':!editTenderForm.controls['amount'].valid}">
            <label for="amount">Montant</label>
            <input type="number" class="form-control" name="amount" id="amount" [formControl]="editTenderForm.controls['amount']">
          </div>

          <p>
            <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
            <button type="submit" class="btn btn-primary" [disabled]="!editTenderForm.valid">Modifier</button>
          </p>
        </form>
      </div>
    </div>
  </div>
</div>